<template>
    <el-dialog title="增加资源开发记录" :visible.sync="dialogVisible" width="50%" ref="ResourceExploitAddDialog">

        <el-descriptions class="margin-top" :column="2" border id="ResourceDescription" title="资源信息">

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    资源名称
                </template>
                {{ resourceItem.resourceName }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    资源单位
                </template>
                {{ resourceItem.unitName !== null ? resourceItem.unitName : '-' }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    资源位置经度
                </template>
                {{ resourceItem.lat }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    资源位置纬度
                </template>
                {{ resourceItem.lon }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    是否有配额
                </template>
                {{ resourceItem.hasQuota ? '是' : '否' }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    资源配额
                </template>
                {{ resourceItem.hasQuota ? resourceItem.quota : '-' }}
            </el-descriptions-item>

        </el-descriptions>

        <el-descriptions class="margin-top" :column="2" border id="FacilityDescription" title="设施信息">

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    设施编号
                </template>
                {{ facilityItem.facilityID }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    设施名称
                </template>
                {{ facilityItem.facilityName }}
            </el-descriptions-item>

            <el-descriptions-item labelStyle="width:20%">
                <template slot="label">
                    设施描述
                </template>
                {{ facilityItem.description }}
            </el-descriptions-item>

        </el-descriptions>


        <el-form ref="form" :model="form" label-width="80px" style="margin-top: 15px;">
            <el-form-item label="开发时间">
                <el-date-picker v-model="addResourceExploit.date" type="date" placeholder="选择日期"
                    value-format="yyyy-MM-dd">
                </el-date-picker>
            </el-form-item>

            <el-form-item label="开发量">
                <el-input v-model="addResourceExploit.amount" placeholder="请输入开发量"></el-input>
            </el-form-item>
        </el-form>

        <span slot="footer" class="dialog-footer">
            <el-button @click="handleCancle">取 消</el-button>
            <el-button type="primary" @click="handleConfirm">确 定</el-button>
        </span>
    </el-dialog>
</template>



<script scoped>
import axios from 'axios'
export default {
    name: 'ResourceExploitAddDialog',

    props: ['resourceItem', 'facilityItem'],

    data() {
        return {
            dialogVisible: false,

            addResourceExploit: {
                recordID: null,
                facilityID: null,
                resourceID: null,
                date: null,
                amount: null
            }
        };
    },

    methods: {
        showDialog() {
            this.dialogVisible = true
        },
        handleCancle() {
            this.recordID = null
            this.facilityID = null
            this.resourceID = null
            this.date = null
            this.amount = null
            this.dialogVisible = false
        },

        handleConfirm() {
            let regex = /^[0-9]*\.?[0-9]+$/
            if (this.addResourceExploit.date === null){
                this.$message.error("开发日期字段不能为空")
                return
            }
                
            if (!regex.test(this.addResourceExploit.amount)){
                this.$message.error("开发量输入格式错误")
                return
            }
    
            this.addResourceExploit.facilityID = this.facilityItem.facilityID
            this.addResourceExploit.resourceID = this.resourceItem.resourceID

            let requestURL = this.$store.state.prefixURL + '/insert/resourceExploit'
            axios.post(requestURL, this.addResourceExploit).then(
                (responce) => {
                    console.log(responce)

                    this.$message.success("新增资源开发记录操作成功")

                    this.dialogVisible = false

                    this.recordID = null
                    this.facilityID = null
                    this.resourceID = null
                    this.date = null
                    this.amount = null
                }
            ).catch(error => {
                console.log(error)
                this.$message.error("网页请求失败!")
            })

        }
    },
}
</script>
