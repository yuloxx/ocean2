<template>

    <el-card class="box-card" id="ResourceExpoiltList">

        <!--表头-->
        <div slot="header" class="clearfix">

            <span>资源开发记录</span>

            <span style="margin: 0px 10px 0px 10px;">

                <el-select v-model="queryItem.resourceTypeID" placeholder="资源类型条件" clearable style="margin-left: 10px; width: 200px;">
                    <el-option v-for="resourceTypeItem in resourceTypeList" :key="resourceTypeItem.resourceTypeID"
                        :label="resourceTypeItem.resourceName" :value="resourceTypeItem.resourceTypeID">
                    </el-option>
                </el-select>

                <el-select v-model="queryItem.facilityID" placeholder="开发设施条件" clearable style="margin-left: 10px; width: 200px;">
                    <el-option v-for="facilityItem in facilityList" :key="facilityItem.facilityID"
                        :label="facilityItem.facilityName" :value="facilityItem.facilityID">
                    </el-option>
                </el-select>

                <el-date-picker v-model="queryItem.startDate" type="date" placeholder="开始日期" value-format="yyyy-MM-dd"
                    clearable style="margin-left: 10px;">
                </el-date-picker>


                <el-date-picker v-model="queryItem.endDate" type="date" placeholder="结束日期" value-format="yyyy-MM-dd"
                    clearable style="margin-left: 10px;">
                </el-date-picker>

                <el-button type="primary" @click="fetchResourceExploitView" style="margin-left: 10px;">查询</el-button>
            </span>

        </div>

        <!--数据列表-->
        <el-table id="table-body" height="600" border :data="listData">

            <el-table-column fixed prop="recordID" label="开发记录编号" width="150">
            </el-table-column>

            <el-table-column prop="date" label="开发日期" width="100">
            </el-table-column>

            <el-table-column prop="facilityName" label="设施名称" width="100">
            </el-table-column>

            <el-table-column prop="resourceName" label="资源名称" width="100">
            </el-table-column>

            <el-table-column prop="amount" label="开发量" width="100">
            </el-table-column>

            <el-table-column prop="unitName" label="单位" width="100">
            </el-table-column>

            <el-table-column prop="lat" label="资源位置经度" width="120">
            </el-table-column>

            <el-table-column prop="lon" label="资源位置纬度" width="120">
            </el-table-column>

            <el-table-column fixed="right" label="操作" width="150">
                <template slot-scope="scope">
                    <el-button @click="handleDel(scope.row)" type="danger" size="small">删除</el-button>
                </template>
            </el-table-column>
        </el-table>

        <!--确认删除对话框-->
        <el-dialog title="提示" :visible.sync="delConfirmDialogVisible" width="30%">
            <strong>确认要删除选定的记录吗?</strong>
            <p>ID:{{ delResourceExploitItem.recordID }}</p>
            <p>设备名称:{{ delResourceExploitItem.facilityName }}</p>
            <p>资源名称:{{ delResourceExploitItem.resourceName }}</p>

            <span slot="footer" class="dialog-footer">
                <el-button @click="delConfirmDialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="handleDelConfirm">确 定</el-button>
            </span>
        </el-dialog>

    </el-card>
</template>

<script>
import axios from 'axios'

export default {
    name: "ResourceExploitList",
    methods: {
        handleDel(row) {
            this.delResourceExploitItem.resourceName = row.resourceName
            this.delResourceExploitItem.recordID = row.recordID
            this.delResourceExploitItem.facilityName = row.facilityName
            this.delConfirmDialogVisible = true
        },
        handleDelConfirm() {
            let requestURL = this.$store.state.prefixURL + '/del/resourceExploit/'
            requestURL = requestURL + this.delResourceExploitItem.recordID
            axios.delete(requestURL).then((responce) => {
                console.log(responce)
                this.fetchResourceExploitView()
                this.$message.success('删除记录操作成功')

                this.delResourceExploitItem.recordID = null
                this.delResourceExploitItem.resourceName = null
                this.delResourceExploitItem.facilityName = null

                this.delConfirmDialogVisible = false
            }).catch(error => {
                console.log(error)
                this.$message.error("网页请求错误")
            })
        },
        fetchResourceExploitView() {
            let requestURL = this.$store.state.prefixURL + '/query/exploit'
            axios.get(requestURL, {
                params: {
                    resourceTypeID: this.queryItem.resourceTypeID,
                    facilityID: this.queryItem.facilityID,
                    startDate: this.queryItem.startDate,
                    endDate: this.queryItem.endDate
                }
            }).then(response => {
                this.listData = response.data.obj
            }).catch(error => {
                console.log(error)
                this.$message.error("网页请求错误!")
            })
        },
        fetchResourceTypeList() {
            let requestURL = this.$store.state.prefixURL + '/query/resourceType'
            axios.get(requestURL).then(
                (responseData) => {
                    this.resourceTypeList = responseData.data.obj
                }
            ).catch(error => {
                console.log(error)
                this.$message.error("网页请求错误")
            })
        },
        fetchFacilityList() {
            let requestURL = this.$store.state.prefixURL + '/query/facility'
            axios.get(requestURL).then(
                (responseData) => {
                    this.facilityList = responseData.data.obj
                }
            ).catch(error => {
                console.log(error)
                this.$message.error("网页请求错误")
            })
        }
    },

    data() {
        return {
            delConfirmDialogVisible: false,
            delResourceExploitItem: {
                resourceID: null,
                resourceName: null
            },

            queryItem: {
                resourceTypeID: null,
                facilityID: null,
                startDate: null,
                endDate: null
            },

            facilityList: null,
            resourceTypeList: null,

            listData: []

        }
    },
    mounted() {
        this.fetchFacilityList()
        this.fetchResourceTypeList()
    }
}
</script>

<style scoped>
#ResourceExpoiltList {
    width: 1146px;
    height: 700px;
    overflow: hidden;

    text-align: left;
    box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
}

#table-body {
    /* height: 500px; */
    width: 100%;
    background-color: white;
}

.text {
    font-size: 14px;
}

.item {
    margin-bottom: 18px;
}

.clearfix:before,
.clearfix:after {
    display: table;
    content: "";
}

.clearfix:after {
    clear: both
}

.box-card {
    width: 480px;
}

#table-header-select {
    float: right;

}
</style>